<!DOCTYPE html>
<html lang="es">
<head>
    <!-- --- METADATOS Y T√çTULO --- -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Viaje Escalonado - Organizado</title>

    <!-- --- ESTILOS CSS --- -->
    <style>
        /* --- ESTILOS PARA EL BLOQUEO DE CONTRASE√ëA --- */
        #password-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(16, 8, 24, 0.95); /* Color oscuro semi-transparente */
            z-index: 10000;
            display: flex;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px); /* Sutil blur al fondo del overlay */
        }

        .password-modal {
            background-color: #1e0e2e; /* Un color de tu paleta */
            padding: 30px 40px;
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
            text-align: center;
            color: white;
        }

        .password-modal h2 {
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .password-modal input[type="password"] {
            padding: 10px 15px;
            border-radius: 5px;
            border: 1px solid #7c5a70;
            background-color: #3a1e3f;
            color: white;
            font-size: 1em;
            margin-bottom: 20px;
            width: 200px;
            text-align: center;
        }
         .password-modal input[type="password"]::placeholder {
            color: #b0aac0;
        }

        .password-modal button {
            padding: 10px 20px;
            border-radius: 5px;
            border: none;
            background-color: #f08080; /* Un color de acento de tu paleta */
            color: #100818;
            font-size: 1em;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .password-modal button:hover {
            background-color: #f8c040;
        }

        .password-modal .error-message {
            color: #ff6b6b;
            font-size: 0.9em;
            margin-top: 10px;
            height: 1.2em; /* Para evitar saltos de layout */
        }

        .content-blocked {
            filter: blur(8px);
            pointer-events: none; /* Evita interacci√≥n mientras est√° borroso */
        }
        body.scroll-locked {
            overflow: hidden;
        }


        /* --- ESTILOS GENERALES DEL VIAJE ESCALONADO --- */
        :root {
            --dark-color: #000; /* Variable de floresamarillas, la mantenemos por si se usa */
        }

        body {
            margin: 0;
            font-family: 'Arial', sans-serif;
            overscroll-behavior: none;
            background-color: #100818;
            color: white;
            height: 300vh; /* Se gestionar√° por JS el bloqueo de scroll inicial */
            transition: filter 0.5s ease-in-out; /* Para la transici√≥n del blur */
        }

        .background-layers {
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100vh;
            z-index: -2;
            pointer-events: none;
        }

        .bg-layer {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            opacity: 0;
            background-size: cover;
            background-position: center center;
            transition: opacity 0.8s ease-in-out;
        }

        #bg-phase-1-actual {
            background: linear-gradient(160deg, #3a1e3f 0%, #1e0e2e 100%);
            opacity: 1;
        }
        #bg-phase-2-actual {
            background: linear-gradient(to bottom, #00081e, #00010a 70%, #100818 100%);
        }
        #bg-phase-3-actual {
            background: linear-gradient(to bottom, #0b071b 0%, #2c1d4a 30%,  #7c5a70 60%, #f08080 80%, #f8c040 100%);
        }

        #persistent-star-sky {
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100vh;
            pointer-events: none;
            z-index: -1;
            overflow: hidden;
        }

        .persistent-star {
            position: absolute; background: white;
            border-radius: 50%; box-shadow: 0 0 3px white, 0 0 6px white;
            animation: twinklePersistent 4s infinite ease-in-out;
        }

        @keyframes twinklePersistent {
            0%, 100% { opacity: 0.2; transform: scale(0.7); }
            50% { opacity: 0.8; transform: scale(1.1); }
        }

        #world-container {
            position: relative; width: 100%; height: 300vh;
        }

        #decorative-elements-container {
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100vh;
            /* pointer-events: none; <--- REMOVIDO para que los indicadores funcionen */
            overflow: hidden;
            z-index: 1;
        }

        .phase-elements {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            opacity: 0;
            /* pointer-events: none; <--- REMOVIDO para que los indicadores funcionen */
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            transition: opacity 0.5s ease-in-out;
        }
        .phase-elements.visible {
            opacity: 1; 
            pointer-events: all; /* Permitir eventos cuando la fase es visible */
        }
        .phase-elements.visible .content-wrapper {
            opacity: 1; transform: translateY(0px);
         }


        .content-wrapper {
            position: relative; z-index: 10;
            padding: 20px; background-color: rgba(0,0,0,0.25);
            border-radius: 10px; opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.3s ease-out 0.2s, transform 0.3s ease-out 0.2s;
            max-width: 80%; 
            box-sizing: border-box;
        }

        /* --- ESTILOS PARA LOS INDICADORES DE NAVEGACI√ìN --- */
        .nav-indicator {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            padding: 8px 15px;
            background-color: rgba(0,0,0,0.35); 
            color: white;
            border-radius: 8px;
            cursor: pointer;
            z-index: 15; 
            font-size: 0.9em;
            opacity: 0; 
            pointer-events: none; 
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
            display: flex; 
            align-items: center;
            gap: 5px;
        }

        .nav-indicator.visible {
            opacity: 1;
            pointer-events: auto;
        }

        .nav-indicator-up {
            top: 20px; 
        }

        .nav-indicator-down {
            bottom: 20px; 
        }
        .nav-indicator.hidden-conditional { 
            display: none !important;
        }


        /* --- Fase 1: Corazones --- */
        .heart-container {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;
        }
        .heart {
            position: absolute; width: 50px; height: 50px;
            transform: scale(var(--base-scale, 1));
            animation: floatPulse 8s infinite ease-in-out;
        }
        .heart::before, .heart::after {
            content: ''; position: absolute; left: 25px; top: 0;
            width: 25px; height: 40px; background: deeppink;
            border-radius: 25px 25px 0 0; transform: rotate(-45deg); transform-origin: 0 100%;
        }
        .heart::after { left: 0; transform: rotate(45deg); transform-origin: 100% 100%; }

        @keyframes floatPulse {
            0%, 100% { transform: translateY(0) scale(var(--base-scale, 1)); opacity: 0.7; filter: blur(0px); }
            25% { transform: scale(calc(var(--base-scale, 1) * 1.1)) rotate(5deg); opacity: 1; filter: blur(1px) brightness(1.2);}
            50% { transform: translateY(-15px) scale(var(--base-scale, 1)); opacity: 0.8; }
            75% { transform: scale(calc(var(--base-scale, 1) * 0.9)) rotate(-5deg); opacity: 0.9; filter: blur(0.5px) brightness(1.1);}
        }

        /* --- Fase 2: Cielo estrellado (espec√≠fico fase 2, adicional al persistente) --- */
        .star-sky {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;
        }
        .star {
             position: absolute; width: 2px; height: 2px; background: white;
            border-radius: 50%; box-shadow: 0 0 5px white, 0 0 10px white;
            animation: twinkle 4s infinite ease-in-out;
        }
         @keyframes twinkle { 0%, 100% { opacity: 0.5; } 50% { opacity: 1; } }

        /* --- Fase 3: Cielo amanecer --- */
        .sun-glow {
            position: absolute; 
            left: 50%; width: 350px; height: 350px;
            background: radial-gradient(circle, rgba(255,235,150,0.9) 0%, rgba(255,210,100,0.5) 40%, rgba(240,128,128,0.2) 70%, transparent 85%);
            border-radius: 50%;
            animation: pulseSun 10s infinite ease-in-out alternate;
            transform: translateX(-50%);
             pointer-events: none;
        }
        @keyframes pulseSun {
            from { box-shadow: 0 0 30px 15px rgba(255,220,100,0.3), 0 0 50px 25px rgba(240,128,128,0.2); }
            to { box-shadow: 0 0 40px 20px rgba(255,230,120,0.4), 0 0 60px 30px rgba(245,140,140,0.3); }
        }

        .cloud-dawn { /* Estilos base para todas las nubes de amanecer */
            position: absolute; background: rgba(255, 255, 255, 0.7);
            border-radius: 50px; box-shadow: 0 0 20px rgba(255,255,255,0.4);
            animation: moveCloudDawn 80s linear infinite alternate;
            pointer-events: none;
        }
        .cloud-dawn::before, .cloud-dawn::after { 
            content: ''; 
            position: absolute; 
            background: inherit; 
            border-radius: 50%;
        }

        /* Estilos espec√≠ficos para la nube 1 */
        .cloud-1 { 
            width: 220px; height: 65px; top: 15%; left: 10%; animation-delay: 0s; 
        } 
        .cloud-1::before { width: 110px; height: 65px; top: -20px; left: 25px; }
        .cloud-1::after { width: 130px; height: 75px; top: -15px; right: 25px; }

        /* Estilos espec√≠ficos para la nube 2 */
        .cloud-2 { 
            width: 280px; height: 75px; top: 30%; left: 60%; animation-delay: -40s; 
        } 
        .cloud-2::before { width: 130px; height: 75px; top: -25px; left: 35px; }
        .cloud-2::after { width: 160px; height: 85px; top: -20px; right: 35px; }


        @keyframes moveCloudDawn {
            0% { transform: translateX(0vw) translateY(0px); }
            50% { transform: translateX(5vw) translateY(-10px); }
            100% { transform: translateX(0vw) translateY(0px); }
        }

        /* --- INICIO: CSS COPIADO Y ADAPTADO DE FLORESAMARILLAS.HTML --- */
        .flowers--left, .flowers--right { /* Estilos comunes para ambos contenedores de flores */
        position: absolute;
        bottom: 0vh;
        /* width: 100%; ELIMINADO */
        display: flex;
        justify-content: center;
        align-items: flex-end;
        height: 70vh;
        pointer-events: none; /* Los elementos hijos .flower tendr√°n pointer-events: auto */
        }

        .flowers--left {
        left: 25%;
        transform: translateX(-50%);
        }
        .flowers--right {
        left: 75%;
        transform: translateX(-50%);
        }

        @media only screen and (max-width: 600px) {
        .flowers--left, .flowers--right {
            height: 60vh;
        }
        }

        .flower {
        position: absolute;
        bottom: 10vmin;
        transform-origin: bottom center;
        z-index: 10; /* Mantenido para que las flores est√©n sobre otros elementos de su fase */
        --fl-speed: 0.8s;
        pointer-events: auto; /* Permitir interacci√≥n con las flores si es necesario en el futuro */
        }
        .flower--1 { animation: moving-flower-1 4s linear infinite; }
        .flower--1 .flower__line { height: 70vmin; animation-delay: 0.3s; }
        .flower--1 .flower__line__leaf--1 { animation: blooming-leaf-right var(--fl-speed) 1.6s backwards; animation-play-state: paused; }
        .flower--1 .flower__line__leaf--2 { animation: blooming-leaf-right var(--fl-speed) 1.4s backwards; animation-play-state: paused; }
        .flower--1 .flower__line__leaf--3 { animation: blooming-leaf-left var(--fl-speed) 1.2s backwards; animation-play-state: paused; }
        .flower--1 .flower__line__leaf--4 { animation: blooming-leaf-left var(--fl-speed) 1s backwards; animation-play-state: paused; }
        .flower--1 .flower__line__leaf--5 { animation: blooming-leaf-right var(--fl-speed) 1.8s backwards; animation-play-state: paused; }
        .flower--1 .flower__line__leaf--6 { animation: blooming-leaf-left var(--fl-speed) 2s backwards; animation-play-state: paused; }

        .flower--2 {
        margin-left: -20vmin;
        transform: rotate(20deg);
        animation: moving-flower-2 4s linear infinite;
        }
        .flower--2 .flower__line { height: 60vmin; animation-delay: 0.6s; }
        .flower--2 .flower__line__leaf--1 { animation: blooming-leaf-right var(--fl-speed) 1.9s backwards; animation-play-state: paused; }
        .flower--2 .flower__line__leaf--2 { animation: blooming-leaf-right var(--fl-speed) 1.7s backwards; animation-play-state: paused; }
        .flower--2 .flower__line__leaf--3 { animation: blooming-leaf-left var(--fl-speed) 1.5s backwards; animation-play-state: paused; }
        .flower--2 .flower__line__leaf--4 { animation: blooming-leaf-left var(--fl-speed) 1.3s backwards; animation-play-state: paused; }

        .flower--3 {
        margin-left: 20vmin;
        transform: rotate(-15deg);
        animation: moving-flower-3 4s linear infinite;
        }
        .flower--3 .flower__line { height: 55vmin; animation-delay: 0.9s; }
        .flower--3 .flower__line__leaf--1 { animation: blooming-leaf-right var(--fl-speed) 2.5s backwards; animation-play-state: paused; }
        .flower--3 .flower__line__leaf--2 { animation: blooming-leaf-right var(--fl-speed) 2.3s backwards; animation-play-state: paused; }
        .flower--3 .flower__line__leaf--3 { animation: blooming-leaf-left var(--fl-speed) 2.1s backwards; animation-play-state: paused; }
        .flower--3 .flower__line__leaf--4 { animation: blooming-leaf-left var(--fl-speed) 1.9s backwards; animation-play-state: paused; }

        .flower__leafs {
            position: relative;
            animation: blooming-flower 2s backwards;
            animation-play-state: paused;
        }
        .flower__leafs--1 { animation-delay: 1.1s; }
        .flower__leafs--2 { animation-delay: 1.4s; }
        .flower__leafs--3 { animation-delay: 1.7s; }
        .flower__leafs::after {
        content: ""; position: absolute; left: 0; top: 0;
        transform: translate(-50%, -100%); width: 8vmin; height: 8vmin;
        background-color: #f9fd25; filter: blur(5vmin);
        }
        .flower__leaf {
        position: absolute; bottom: 0; left: 50%;
        width: 8vmin; height: 11vmin;
        border-radius: 51% 49% 47% 53%/44% 45% 55% 69%;
        background-color: #fddd25;
        transform-origin: bottom center; opacity: 0.9;
        box-shadow: inset 0 0 2vmin rgba(255, 255, 255, 0.5);
        }
        .flower__leaf--1 { transform: translate(-10%, 1%) rotateY(40deg) rotateX(-50deg); }
        .flower__leaf--2 { transform: translate(-50%, -4%) rotateX(40deg); }
        .flower__leaf--3 { transform: translate(-90%, 0%) rotateY(45deg) rotateX(50deg); }
        .flower__leaf--4 {
        width: 8vmin; height: 8vmin;
        transform-origin: bottom left;
        border-radius: 4vmin 10vmin 4vmin 4vmin;
        transform: translate(0%, 18%) rotateX(70deg) rotate(-43deg);
        background-color: #bfa000;
        z-index: 1; opacity: 0.8;
        }
        .flower__white-circle {
        position: absolute; left: -3.5vmin; top: -3vmin;
        width: 9vmin; height: 4vmin; border-radius: 50%;
        background-color: #fff;
        }
        .flower__white-circle::after {
        content: ""; position: absolute; left: 50%; top: 45%;
        transform: translate(-50%, -50%); width: 60%; height: 60%;
        border-radius: inherit;
        background-image:
            repeating-linear-gradient(135deg, rgba(0,0,0,0.03) 0px, rgba(0,0,0,0.03) 1px, transparent 1px, transparent 12px),
            linear-gradient(90deg, rgb(255, 235, 18), rgb(255, 206, 0));
        }
        .flower__line {
        width: 1.5vmin;
        background-image: linear-gradient(to left, rgba(0,0,0,0.2), transparent, rgba(255,255,255,0.2)),
                            linear-gradient(to top, transparent 10%, #2e8b57, #3cb371);
        box-shadow: inset 0 0 2px rgba(0,0,0,0.5);
        animation: grow-flower-tree 4s backwards;
        animation-play-state: paused;
        }
        .flower__line__leaf {
        --w: 7vmin; --h: calc(var(--w) + 2vmin);
        position: absolute; top: 20%; left: 90%;
        width: var(--w); height: var(--h);
        border-top-right-radius: var(--h);
        border-bottom-left-radius: var(--h);
        background-image: linear-gradient(to top, rgba(0, 100, 0, 0.4), #55a055);
        }
        .flower__line__leaf--1 { transform: rotate(70deg) rotateY(30deg); }
        .flower__line__leaf--2 { top: 45%; transform: rotate(70deg) rotateY(30deg); }
        .flower__line__leaf--3, .flower__line__leaf--4, .flower__line__leaf--6 {
        border-top-right-radius: 0; border-bottom-left-radius: 0;
        border-top-left-radius: var(--h); border-bottom-right-radius: var(--h);
        left: -460%; top: 12%; transform: rotate(-70deg) rotateY(30deg);
        }
        .flower__line__leaf--4 { top: 40%; }
        .flower__line__leaf--5 { top: 0; transform-origin: left; transform: rotate(70deg) rotateY(30deg) scale(0.6); }
        .flower__line__leaf--6 { top: -2%; left: -450%; transform-origin: right; transform: rotate(-70deg) rotateY(30deg) scale(0.6); }

        .flower__light {
        position: absolute; bottom: 0vmin; width: 1vmin; height: 1vmin;
        background-color: rgb(255,251,0); border-radius: 50%;
        filter: blur(0.2vmin);
        animation: light-ans 4s linear infinite backwards;
        }
        .flower__light:nth-child(odd) { background-color: #ffefAD; }
        .flower__light--1 { left: -2vmin; animation-delay: 1s;}
        .flower__light--2 { left: 3vmin; animation-delay: 0.5s;}
        .flower__light--3 { left: -6vmin; animation-delay: 0.3s;}
        .flower__light--4 { left: 6vmin; animation-delay: 0.9s;}
        .flower__light--5 { left: -1vmin; animation-delay: 1.5s;}
        .flower__light--6 { left: -4vmin; animation-delay: 3s;}
        .flower__light--7 { left: 3vmin; animation-delay: 2s;}
        .flower__light--8 { left: -6vmin; animation-delay: 3.5s;}

        .grow-ans {
            animation: grow-ans 2s var(--d) backwards;
            display:inline-block;
            animation-play-state: paused;
        }
        .flower__g-long {
        --w: 2vmin; --h: 6vmin; --c: #2e8b57;
        position: absolute; bottom: -5vmin;
        display: flex; flex-direction: column; align-items: flex-end;
        animation: flower-g-long-ans 3s linear infinite;
        }
        .flower__g-long__top {
        top: calc(var(--h) * -1); width: calc(var(--w) + 1vmin); height: var(--h);
        border-top-right-radius: 100%; border-right: 0.7vmin solid var(--c);
        transform: translate(-0.7vmin, 1vmin);
        }
        .flower__g-long__bottom {
        width: var(--w); transform-origin: bottom center;
        background-image: linear-gradient(to top, transparent 30%, var(--c));
        box-shadow: inset 0 0 2px rgba(0,0,0,0.5);
        clip-path: polygon(35% 0, 65% 1%, 100% 100%, 0% 100%);
        }
        @keyframes grow-ans { 0% { transform: scale(0); opacity: 0; } }
        @keyframes light-ans {
        0% { opacity: 0; transform: translateY(0vmin); }
        25% { opacity: 1; transform: translateY(-5vmin) translateX(-2vmin); }
        50% { opacity: 1; transform: translateY(-15vmin) translateX(2vmin); filter: blur(0.2vmin); }
        75% { transform: translateY(-20vmin) translateX(-2vmin); filter: blur(0.2vmin); }
        100% { transform: translateY(-30vmin); opacity: 0; filter: blur(1vmin); }
        }
        @keyframes moving-flower-1 { 0%,100% { transform: rotate(2deg); } 50% { transform: rotate(-2deg); } }
        @keyframes moving-flower-2 { 0%,100% { transform: rotate(18deg); } 50% { transform: rotate(14deg); } }
        @keyframes moving-flower-3 { 0%,100% { transform: rotate(-18deg); } 50% { transform: rotate(-20deg) rotateY(-10deg); } }
        @keyframes blooming-leaf-right { 0% { transform-origin: left; transform: rotate(70deg) rotateY(30deg) scale(0); } }
        @keyframes blooming-leaf-left { 0% { transform-origin: right; transform: rotate(-70deg) rotateY(30deg) scale(0); } }
        @keyframes grow-flower-tree { 0% { height: 0; border-radius: 1vmin; } }
        @keyframes blooming-flower { 0% { transform: scale(0); } }
        @keyframes flower-g-long-ans {
        0%,100% { transform: rotate(-30deg) rotateY(-20deg); }
        50% { transform: rotate(-32deg) rotateY(-20deg); }
        }
        /* --- FIN: CSS COPIADO Y ADAPTADO DE FLORESAMARILLAS.HTML --- */

    </style>
</head>
<body class="scroll-locked">
    <div id="password-overlay">
        <div class="password-modal">
            <h2>üß∂</h2>
            <input type="password" id="password-input" placeholder="Contrase√±a Secreta">
            <button id="submit-password">Desbloquear</button>
            <p class="error-message" id="error-message">¬†</p>
        </div>
    </div>

    <div class="background-layers">
        <div class="bg-layer" id="bg-phase-1-actual"></div>
        <div class="bg-layer" id="bg-phase-2-actual"></div>
        <div class="bg-layer" id="bg-phase-3-actual"></div>
    </div>

    <div id="persistent-star-sky"></div>

    <main id="world-container">
        <div data-phase="1" style="height: 100vh;"></div>
        <div data-phase="2" style="height: 100vh;"></div>
        <div data-phase="3" style="height: 100vh;"></div>
    </main>

    <div id="decorative-elements-container">
        <div id="phase-1-elements" class="phase-elements" data-phase-number="1">
            <div class="nav-indicator nav-indicator-up" data-direction="up"><span>‚Üë</span> Anterior</div>
            <div class="heart-container">
                <div class="heart" style="top: 10%; left: 15%; --base-scale: 0.8;"></div>
                <div class="heart" style="top: 30%; left: 70%; --base-scale: 1.2;"></div>
                <div class="heart" style="top: 60%; left: 25%; --base-scale: 1.0;"></div>
                <div class="heart" style="top: 80%; left: 80%; --base-scale: 0.7;"></div>
                <div class="heart" style="top: 40%; left: 40%; --base-scale: 0.9;"></div>
            </div>
            <div class="content-wrapper">
                <h1>‚ù§Ô∏èTibur√≥ncita¬†</h1>
                <p>Gracias por tantos momentos hermosos y por compartir de manera tan bonita conmigo, Gracias por cada mensaje, cada gesto, cada abrazo, cada risa, por tratarme de forma sincera, por ser quien eres</p>
            </div>
            <div class="nav-indicator nav-indicator-down" data-direction="down">Siguiente <span>‚Üì</span></div>
        </div>

        <div id="phase-2-elements" class="phase-elements" data-phase-number="2">
            <div class="nav-indicator nav-indicator-up" data-direction="up"><span>‚Üë</span> Anterior</div>
            <div class="star-sky">
                <div class="star" style="top: 10%; left: 15%;"></div> <div class="star" style="top: 20%; left: 85%; width:3px; height:3px;"></div>
                <div class="star" style="top: 30%; left: 35%;"></div> <div class="star" style="top: 45%; left: 70%; width:1px; height:1px;"></div>
                <div class="star" style="top: 60%; left: 10%;"></div> <div class="star" style="top: 75%; left: 50%; width:3px; height:3px;"></div>
                <div class="star" style="top: 5%; left: 50%;"></div> <div class="star" style="top: 50%; left: 90%;"></div>
                <div class="star" style="top: 85%; left: 20%;"></div> <div class="star" style="top: 90%; left: 75%; width:1px; height:1px;"></div>
            </div>

            <div class="flowers flowers--left">
              <div class="flower flower--1">
                <div class="flower__leafs flower__leafs--1">
                  <div class="flower__leaf flower__leaf--1"></div><div class="flower__leaf flower__leaf--2"></div><div class="flower__leaf flower__leaf--3"></div><div class="flower__leaf flower__leaf--4"></div>
                  <div class="flower__white-circle"></div>
                  <div class="flower__light flower__light--1"></div><div class="flower__light flower__light--2"></div><div class="flower__light flower__light--3"></div><div class="flower__light flower__light--4"></div><div class="flower__light flower__light--5"></div><div class="flower__light flower__light--6"></div><div class="flower__light flower__light--7"></div><div class="flower__light flower__light--8"></div>
                </div>
                <div class="flower__line">
                  <div class="flower__line__leaf flower__line__leaf--1"></div><div class="flower__line__leaf flower__line__leaf--2"></div><div class="flower__line__leaf flower__line__leaf--3"></div><div class="flower__line__leaf flower__line__leaf--4"></div><div class="flower__line__leaf flower__line__leaf--5"></div><div class="flower__line__leaf flower__line__leaf--6"></div>
                </div>
              </div>
              <div class="flower flower--2">
                <div class="flower__leafs flower__leafs--2">
                  <div class="flower__leaf flower__leaf--1"></div><div class="flower__leaf flower__leaf--2"></div><div class="flower__leaf flower__leaf--3"></div><div class="flower__leaf flower__leaf--4"></div>
                  <div class="flower__white-circle"></div>
                  <div class="flower__light flower__light--1"></div><div class="flower__light flower__light--2"></div><div class="flower__light flower__light--3"></div><div class="flower__light flower__light--4"></div><div class="flower__light flower__light--5"></div><div class="flower__light flower__light--6"></div><div class="flower__light flower__light--7"></div><div class="flower__light flower__light--8"></div>
                </div>
                <div class="flower__line">
                  <div class="flower__line__leaf flower__line__leaf--1"></div><div class="flower__line__leaf flower__line__leaf--2"></div><div class="flower__line__leaf flower__line__leaf--3"></div><div class="flower__line__leaf flower__line__leaf--4"></div>
                </div>
              </div>
              <div class="flower flower--3">
                <div class="flower__leafs flower__leafs--3">
                  <div class="flower__leaf flower__leaf--1"></div><div class="flower__leaf flower__leaf--2"></div><div class="flower__leaf flower__leaf--3"></div><div class="flower__leaf flower__leaf--4"></div>
                  <div class="flower__white-circle"></div>
                  <div class="flower__light flower__light--1"></div><div class="flower__light flower__light--2"></div><div class="flower__light flower__light--3"></div><div class="flower__light flower__light--4"></div><div class="flower__light flower__light--5"></div><div class="flower__light flower__light--6"></div><div class="flower__light flower__light--7"></div><div class="flower__light flower__light--8"></div>
                </div>
                <div class="flower__line">
                  <div class="flower__line__leaf flower__line__leaf--1"></div><div class="flower__line__leaf flower__line__leaf--2"></div><div class="flower__line__leaf flower__line__leaf--3"></div><div class="flower__line__leaf flower__line__leaf--4"></div>
                </div>
              </div>
              <div class="grow-ans" style="--d: 1.2s; position: relative; bottom: 0; left: -15vmin; transform: rotate(-30deg) rotateY(-20deg);">
                <div class="flower__g-long"><div class="flower__g-long__top"></div><div class="flower__g-long__bottom" style="height:50vmin;"></div></div>
              </div>
               <div class="grow-ans" style="--d: 1.4s; position: relative; bottom: 0; left: 15vmin; transform: scaleX(-1) rotate(-30deg) rotateY(20deg);">
                <div class="flower__g-long"><div class="flower__g-long__top"></div><div class="flower__g-long__bottom" style="height:40vmin;"></div></div>
              </div>
            </div>
            <div class="flowers flowers--right">
              <div class="flower flower--1">
                <div class="flower__leafs flower__leafs--1">
                  <div class="flower__leaf flower__leaf--1"></div><div class="flower__leaf flower__leaf--2"></div><div class="flower__leaf flower__leaf--3"></div><div class="flower__leaf flower__leaf--4"></div>
                  <div class="flower__white-circle"></div>
                  <div class="flower__light flower__light--1"></div><div class="flower__light flower__light--2"></div><div class="flower__light flower__light--3"></div><div class="flower__light flower__light--4"></div><div class="flower__light flower__light--5"></div><div class="flower__light flower__light--6"></div><div class="flower__light flower__light--7"></div><div class="flower__light flower__light--8"></div>
                </div>
                <div class="flower__line">
                  <div class="flower__line__leaf flower__line__leaf--1"></div><div class="flower__line__leaf flower__line__leaf--2"></div><div class="flower__line__leaf flower__line__leaf--3"></div><div class="flower__line__leaf flower__line__leaf--4"></div><div class="flower__line__leaf flower__line__leaf--5"></div><div class="flower__line__leaf flower__line__leaf--6"></div>
                </div>
              </div>
              <div class="flower flower--2">
                <div class="flower__leafs flower__leafs--2">
                  <div class="flower__leaf flower__leaf--1"></div><div class="flower__leaf flower__leaf--2"></div><div class="flower__leaf flower__leaf--3"></div><div class="flower__leaf flower__leaf--4"></div>
                  <div class="flower__white-circle"></div>
                  <div class="flower__light flower__light--1"></div><div class="flower__light flower__light--2"></div><div class="flower__light flower__light--3"></div><div class="flower__light flower__light--4"></div><div class="flower__light flower__light--5"></div><div class="flower__light flower__light--6"></div><div class="flower__light flower__light--7"></div><div class="flower__light flower__light--8"></div>
                </div>
                <div class="flower__line">
                  <div class="flower__line__leaf flower__line__leaf--1"></div><div class="flower__line__leaf flower__line__leaf--2"></div><div class="flower__line__leaf flower__line__leaf--3"></div><div class="flower__line__leaf flower__line__leaf--4"></div>
                </div>
              </div>
              <div class="flower flower--3">
                <div class="flower__leafs flower__leafs--3">
                  <div class="flower__leaf flower__leaf--1"></div><div class="flower__leaf flower__leaf--2"></div><div class="flower__leaf flower__leaf--3"></div><div class="flower__leaf flower__leaf--4"></div>
                  <div class="flower__white-circle"></div>
                  <div class="flower__light flower__light--1"></div><div class="flower__light flower__light--2"></div><div class="flower__light flower__light--3"></div><div class="flower__light flower__light--4"></div><div class="flower__light flower__light--5"></div><div class="flower__light flower__light--6"></div><div class="flower__light flower__light--7"></div><div class="flower__light flower__light--8"></div>
                </div>
                <div class="flower__line">
                  <div class="flower__line__leaf flower__line__leaf--1"></div><div class="flower__line__leaf flower__line__leaf--2"></div><div class="flower__line__leaf flower__line__leaf--3"></div><div class="flower__line__leaf flower__line__leaf--4"></div>
                </div>
              </div>
              <div class="grow-ans" style="--d: 1.2s; position: relative; bottom: 0; left: -15vmin; transform: rotate(-30deg) rotateY(-20deg);">
                <div class="flower__g-long"><div class="flower__g-long__top"></div><div class="flower__g-long__bottom" style="height:50vmin;"></div></div>
              </div>
               <div class="grow-ans" style="--d: 1.4s; position: relative; bottom: 0; left: 15vmin; transform: scaleX(-1) rotate(-30deg) rotateY(20deg);">
                <div class="flower__g-long"><div class="flower__g-long__top"></div><div class="flower__g-long__bottom" style="height:40vmin;"></div></div>
              </div>
            </div>

            <div class="content-wrapper">
                <h1>üå∑Cosita Hermosa</h1>
                <p>Ador√© cada noche que hablamos, la emoci√≥n que me contagias cada despedida de buenas noches, adoro escuchar tu voz. S√© que te debo un quesillo, una pizza y una cachapa, por lo menos una florecita y bueno, much√≠simo m√°s... </p>
            </div>
            <div class="nav-indicator nav-indicator-down" data-direction="down">Siguiente <span>‚Üì</span></div>
        </div>

        <div id="phase-3-elements" class="phase-elements" data-phase-number="3">
            <div class="nav-indicator nav-indicator-up" data-direction="up"><span>‚Üë</span> Anterior</div>
            <div class="sun-glow"></div>
            <div class="cloud-dawn cloud-1"></div> <!-- Clase espec√≠fica para la nube 1 -->
            <div class="cloud-dawn cloud-2"></div> <!-- Clase espec√≠fica para la nube 2 -->
            <div class="content-wrapper">
                <h1>Eres una Preciosuraüòò</h1>
                <p>Disfrut√© cada mensaje de buenos d√≠as y amo despertar y escuchar tu voz. Sin importar lo que suceda, es hermoso sentir por ti.</p>
            </div>
            <div class="nav-indicator nav-indicator-down" data-direction="down">Siguiente <span>‚Üì</span></div>
        </div>
    </div>


    <script src="https://unpkg.com/@studio-freight/lenis@1.0.42/dist/lenis.min.js"></script>
    <script>
        const SECRET_PASSWORD = "Maria"; // CAMBIA ESTO! contrase√±a
        const passwordOverlay = document.getElementById('password-overlay');
        const passwordInput = document.getElementById('password-input');
        const submitPasswordButton = document.getElementById('submit-password');
        const errorMessage = document.getElementById('error-message');
        const bodyElement = document.body;
        const mainContentElements = [ 
            document.getElementById('world-container'),
            document.getElementById('decorative-elements-container'),
            document.querySelector('.background-layers'),
            document.getElementById('persistent-star-sky')
        ];

        function applyContentBlock() {
            bodyElement.classList.add('scroll-locked');
            mainContentElements.forEach(el => el && el.classList.add('content-blocked'));
        }

        function removeContentBlock() {
            passwordOverlay.style.display = 'none'; 
            bodyElement.classList.remove('scroll-locked');
            mainContentElements.forEach(el => el && el.classList.remove('content-blocked'));
        }
        
        let lenisInstance;
        let indicatorVisibilityTimer;
        const ALL_NAV_INDICATORS = document.querySelectorAll('.nav-indicator');
        const TOTAL_PHASES = 3; 

        function initializePageContent() {
            if (typeof Lenis === 'undefined') {
                console.warn('Lenis class not available yet, retrying...');
                setTimeout(initializePageContent, 50); 
                return;
            }

            lenisInstance = new Lenis({ 
                duration: 1.2, 
                easing: (t) => Math.min(1, 1.001 - Math.pow(2, -10 * t)),
                smoothWheel: true,
            });

            function raf(time) {
                if (lenisInstance) lenisInstance.raf(time); 
                requestAnimationFrame(raf);
            }
            requestAnimationFrame(raf);

            if (lenisInstance) { 
                lenisInstance.on('scroll', handleLenisScroll); 
                setTimeout(() => {
                    if (lenisInstance) {
                        lenisInstance.emit();
                        hideAllNavIndicators();
                    }
                }, 100);
            }
            createPersistentStars();
            setupNavIndicators();
            setupGlobalInteractionListener(); 
        }

        function checkPassword() {
            const enteredPassword = passwordInput.value;
            if (enteredPassword === SECRET_PASSWORD) {
                sessionStorage.setItem('isUnlocked', 'true'); 
                removeContentBlock();
                initializePageContent(); 
            } else {
                errorMessage.textContent = "Contrase√±a incorrecta.";
                passwordInput.value = "";
                passwordInput.focus();
                passwordInput.style.borderColor = "#ff6b6b";
                setTimeout(() => {
                     passwordInput.style.borderColor = "#7c5a70"; 
                     errorMessage.textContent = "\u00A0"; 
                }, 2000);
            }
        }

        submitPasswordButton.addEventListener('click', checkPassword);
        passwordInput.addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                event.preventDefault(); 
                checkPassword();
            }
        });

        const bgPhase1 = document.getElementById('bg-phase-1-actual');
        const bgPhase2 = document.getElementById('bg-phase-2-actual');
        const bgPhase3 = document.getElementById('bg-phase-3-actual');
        const phase1Elements = document.getElementById('phase-1-elements');
        const phase2Elements = document.getElementById('phase-2-elements');
        const phase3Elements = document.getElementById('phase-3-elements');
        const phaseElementsList = [phase1Elements, phase2Elements, phase3Elements];


        const phaseRanges = {
            1: { start: 0, end: 1/3 },
            2: { start: 1/3, end: 2/3 },
            3: { start: 2/3, end: 1 }
        };
        const bgTransitionRanges = {
            '1to2': { startInPhase: 0.6, endInPhase: 0.9 }, 
            '2to3': { startInPhase: 0.7, endInPhase: 1.0 }  
        };


        let currentActivePhaseNumber = 1; 

        function handleLenisScroll(e) {
            if (!lenisInstance) return;
            const scrollProgress = e.progress; 

            if (scrollProgress < phaseRanges[1].end) currentActivePhaseNumber = 1;
            else if (scrollProgress < phaseRanges[2].end) currentActivePhaseNumber = 2;
            else currentActivePhaseNumber = 3;

            let opacity1 = 0, opacity2 = 0, opacity3 = 0;

            const progressInPhase1 = Math.max(0, Math.min(1, (scrollProgress - phaseRanges[1].start) / (phaseRanges[1].end - phaseRanges[1].start)));
            const progressInPhase2 = Math.max(0, Math.min(1, (scrollProgress - phaseRanges[2].start) / (phaseRanges[2].end - phaseRanges[2].start)));
            
            if (scrollProgress < phaseRanges[1].end * bgTransitionRanges['1to2'].startInPhase) { 
                opacity1 = 1;
            } else if (scrollProgress < phaseRanges[1].end) { 
                const transitionProgress = (progressInPhase1 - bgTransitionRanges['1to2'].startInPhase) / (bgTransitionRanges['1to2'].endInPhase - bgTransitionRanges['1to2'].startInPhase);
                opacity1 = 1 - Math.min(1, Math.max(0, transitionProgress));
            } else {
                opacity1 = 0;
            }

            if (scrollProgress >= phaseRanges[1].end * bgTransitionRanges['1to2'].startInPhase && scrollProgress < phaseRanges[2].end * bgTransitionRanges['2to3'].startInPhase) {
                if (scrollProgress < phaseRanges[1].end) { 
                    const transitionProgress = (progressInPhase1 - bgTransitionRanges['1to2'].startInPhase) / (bgTransitionRanges['1to2'].endInPhase - bgTransitionRanges['1to2'].startInPhase);
                    opacity2 = Math.min(1, Math.max(0, transitionProgress));
                } else { 
                    opacity2 = 1;
                }
            } else if (scrollProgress >= phaseRanges[2].end * bgTransitionRanges['2to3'].startInPhase && scrollProgress < phaseRanges[2].end) { 
                const transitionProgress = (progressInPhase2 - bgTransitionRanges['2to3'].startInPhase) / (bgTransitionRanges['2to3'].endInPhase - bgTransitionRanges['2to3'].startInPhase);
                opacity2 = 1 - Math.min(1, Math.max(0, transitionProgress));
            } else if (scrollProgress >= phaseRanges[2].end && currentActivePhaseNumber < 3) { // Asegurarse de que bg2 est√© en 0 si pasamos a la fase 3
                 opacity2 = 0;
            }


            if (scrollProgress >= phaseRanges[2].end * bgTransitionRanges['2to3'].startInPhase) {
                 if (scrollProgress < phaseRanges[2].end) { 
                    const transitionProgress = (progressInPhase2 - bgTransitionRanges['2to3'].startInPhase) / (bgTransitionRanges['2to3'].endInPhase - bgTransitionRanges['2to3'].startInPhase);
                    opacity3 = Math.min(1, Math.max(0, transitionProgress));
                } else { 
                     opacity3 = 1;
                }
            } else {
                opacity3 = 0;
            }

            if (bgPhase1) bgPhase1.style.opacity = opacity1;
            if (bgPhase2) bgPhase2.style.opacity = opacity2;
            if (bgPhase3) bgPhase3.style.opacity = opacity3;

            managePhaseElements(phase1Elements, phaseRanges[1], scrollProgress);
            managePhaseElements(phase2Elements, phaseRanges[2], scrollProgress);
            managePhaseElements(phase3Elements, phaseRanges[3], scrollProgress);
        }

        function managePhaseElements(elementsContainer, phaseRange, scrollProgress) {
            if (!elementsContainer) return; 
            const progressInPhase = (scrollProgress - phaseRange.start) / (phaseRange.end - phaseRange.start);
            let isVisible = scrollProgress >= phaseRange.start && scrollProgress < phaseRange.end;

            if (isVisible) {
                elementsContainer.classList.add('visible');
            } else {
                elementsContainer.classList.remove('visible');
            }

            // Excluir .sun-glow y .cloud-dawn de la animaci√≥n gen√©rica, ya que tienen la suya propia
            elementsContainer.querySelectorAll(':scope > *:not(.content-wrapper):not(.nav-indicator):not(.sun-glow):not(.cloud-dawn)').forEach((element, index) => {
                const entranceDuration = 0.2;
                const exitDuration = 0.2;
                const elementDelayFactor = 0.05;
                const elementDelay = parseFloat(element.dataset.delay) || (index * elementDelayFactor);

                let elementOpacity = 0;
                let elementTransformY = "50px";
                let elementScale = 0.8;

                let currentProgressInPhaseForElement = progressInPhase;

                if (isVisible) {
                    if (currentProgressInPhaseForElement >= elementDelay && currentProgressInPhaseForElement < entranceDuration + elementDelay) {
                        const entranceProgress = (currentProgressInPhaseForElement - elementDelay) / entranceDuration;
                        elementOpacity = Math.min(1, entranceProgress);
                        elementTransformY = `${50 * (1 - elementOpacity)}px`;
                        elementScale = 0.8 + elementOpacity * 0.2;
                    } else if (currentProgressInPhaseForElement >= entranceDuration + elementDelay && currentProgressInPhaseForElement < 1 - exitDuration) {
                        elementOpacity = 1;
                        elementTransformY = "0px";
                        elementScale = 1;
                    } else if (currentProgressInPhaseForElement >= 1 - exitDuration && currentProgressInPhaseForElement <= 1 ) {
                        const exitProgressNorm = (currentProgressInPhaseForElement - (1 - exitDuration)) / exitDuration;
                        elementOpacity = Math.max(0, 1 - exitProgressNorm);
                        elementTransformY = `${50 * exitProgressNorm}px`;
                        elementScale = Math.max(0.8, 1 - exitProgressNorm * 0.2);
                    } else if (currentProgressInPhaseForElement > 1 || currentProgressInPhaseForElement < elementDelay) {
                        elementOpacity = 0;
                        elementTransformY = "50px";
                        elementScale = 0.8;
                    }
                } else {
                    elementOpacity = 0;
                    elementTransformY = "50px";
                    elementScale = 0.8;
                }
                
                elementOpacity = Math.max(0, Math.min(1, elementOpacity));
                element.style.opacity = elementOpacity;

                if (element.classList.contains('heart') || element.classList.contains('star-sky')) {
                    element.style.transform = `translateY(${elementTransformY}) scale(${elementScale})`;
                } else if (element.classList.contains('flowers')) {
                    const baseTransform = element.classList.contains('flowers--left') || element.classList.contains('flowers--right') ? 'translateX(-50%) ' : '';
                    element.style.transform = `${baseTransform}translateY(${elementTransformY}) scale(${elementScale})`;
                    
                    const animatedParts = element.querySelectorAll('.flower, .grow-ans, .flower__line, .flower__line__leaf, .flower__leafs, .flower__light, .flower__g-long');
                    animatedParts.forEach(part => {
                        const computedAnimationName = getComputedStyle(part).animationName;
                        if (computedAnimationName && computedAnimationName !== 'none') {
                            part.style.animationPlayState = (elementOpacity > 0.1) ? 'running' : 'paused';
                        }
                    });
                }
                // No necesitamos manejar .sun-glow y .cloud-dawn aqu√≠ para la animaci√≥n gen√©rica
            });

            // Manejar animaci√≥n espec√≠fica para .sun-glow y .cloud-dawn si est√°n en este contenedor
            const sunGlowElement = elementsContainer.querySelector('.sun-glow');
            if (sunGlowElement) {
                animateSunGlow(sunGlowElement, progressInPhase, isVisible);
            }
            elementsContainer.querySelectorAll('.cloud-dawn').forEach(cloudElement => {
                 animateCloudDawn(cloudElement, progressInPhase, isVisible);
            });
        }
        
        function animateSunGlow(element, progressInPhase, isVisiblePhase) {
            // L√≥gica de animaci√≥n espec√≠fica del sol (igual que antes)
            const entranceDuration = 0.2, exitDuration = 0.2, elementDelay = 0; // Asumir delay 0 para el sol
            let elementOpacity = 0;
            
            if (isVisiblePhase) {
                if (progressInPhase >= elementDelay && progressInPhase < entranceDuration + elementDelay) {
                    const entranceProgress = (progressInPhase - elementDelay) / entranceDuration;
                    elementOpacity = Math.min(1, entranceProgress);
                } else if (progressInPhase >= entranceDuration + elementDelay && progressInPhase < 1 - exitDuration) {
                    elementOpacity = 1;
                } else if (progressInPhase >= 1 - exitDuration && progressInPhase <= 1 ) {
                    const exitProgressNorm = (progressInPhase - (1 - exitDuration)) / exitDuration;
                    elementOpacity = Math.max(0, 1 - exitProgressNorm);
                }
            }
            elementOpacity = Math.max(0, Math.min(1, elementOpacity));
            
            const maxSunOpacity = 0.653;
            const maxSunScale = 0.93;
            let currentSunOpacity = Math.min(elementOpacity, maxSunOpacity);
            element.style.opacity = currentSunOpacity;

            const finalSunTopVh = 50;
            const finalSunTopPx = finalSunTopVh * window.innerHeight / 100;
            const initialSunTopPx = window.innerHeight;
            const initialSunScale = 0.1;

            let rawAppearanceProgress = 0;
            if (isVisiblePhase) { // Usar el mismo c√°lculo de rawAppearanceProgress que antes
                if (progressInPhase >= elementDelay && progressInPhase < entranceDuration + elementDelay) {
                     rawAppearanceProgress = (progressInPhase - elementDelay) / entranceDuration;
                } else if (progressInPhase >= entranceDuration + elementDelay && progressInPhase < 1 - exitDuration) {
                    rawAppearanceProgress = 1;
                } else if (progressInPhase >= 1 - exitDuration && progressInPhase <= 1) {
                    const exitProgressNorm = (progressInPhase - (1 - exitDuration)) / exitDuration;
                    rawAppearanceProgress = Math.max(0, 1 - exitProgressNorm);
                }
            }
            rawAppearanceProgress = Math.max(0, Math.min(1, rawAppearanceProgress));

            let interpolatedSunTop = initialSunTopPx + (finalSunTopPx - initialSunTopPx) * rawAppearanceProgress;
            let interpolatedSunScale = initialSunScale + (maxSunScale - initialSunScale) * rawAppearanceProgress;
            
            interpolatedSunTop = Math.max(finalSunTopPx, Math.min(initialSunTopPx, interpolatedSunTop));
            interpolatedSunScale = Math.min(maxSunScale, Math.max(initialSunScale, interpolatedSunScale));
            
            if (elementOpacity === 0) {
                interpolatedSunTop = initialSunTopPx;
                interpolatedSunScale = initialSunScale;
            }

            element.style.bottom = '';
            element.style.top = `${interpolatedSunTop}px`;
            element.style.transform = `translateX(-50%) scale(${interpolatedSunScale})`;
            element.style.animationPlayState = (rawAppearanceProgress > 0.85 && currentSunOpacity > 0.01) ? 'running' : 'paused';
        }

        function animateCloudDawn(element, progressInPhase, isVisiblePhase) {
            // L√≥gica de animaci√≥n espec√≠fica de las nubes (similar a la gen√©rica pero separada)
            const entranceDuration = 0.2, exitDuration = 0.2, elementDelay = 0.1; // Un peque√±o delay para las nubes
            let elementOpacity = 0;
            let elementTransformY = "50px";
            let elementScale = 0.8;

            if (isVisiblePhase) {
                if (progressInPhase >= elementDelay && progressInPhase < entranceDuration + elementDelay) {
                    const entranceProgress = (progressInPhase - elementDelay) / entranceDuration;
                    elementOpacity = Math.min(1, entranceProgress);
                    elementTransformY = `${50 * (1 - elementOpacity)}px`;
                    elementScale = 0.8 + elementOpacity * 0.2;
                } else if (progressInPhase >= entranceDuration + elementDelay && progressInPhase < 1 - exitDuration) {
                    elementOpacity = 1; elementTransformY = "0px"; elementScale = 1;
                } else if (progressInPhase >= 1 - exitDuration && progressInPhase <= 1 ) {
                    const exitProgressNorm = (progressInPhase - (1 - exitDuration)) / exitDuration;
                    elementOpacity = Math.max(0, 1 - exitProgressNorm);
                    elementTransformY = `${50 * exitProgressNorm}px`;
                    elementScale = Math.max(0.8, 1 - exitProgressNorm * 0.2);
                }
            }
            element.style.opacity = Math.max(0, Math.min(1, elementOpacity));
            element.style.transform = `translateY(${elementTransformY}) scale(${elementScale})`;
            element.style.animationPlayState = (elementOpacity > 0.9) ? 'running' : 'paused';
        }


        function createPersistentStars() {
            const starContainer = document.getElementById('persistent-star-sky');
            if (!starContainer) return;
            if (starContainer.childElementCount > 0) return; 
            const numberOfStars = 150;
            for (let i = 0; i < numberOfStars; i++) {
                const star = document.createElement('div');
                star.classList.add('persistent-star');
                const size = Math.random() * 2.0 + 0.5;
                star.style.width = `${size}px`; star.style.height = `${size}px`;
                star.style.top = `${Math.random() * 100}%`; star.style.left = `${Math.random() * 100}%`;
                const duration = Math.random() * 4 + 3; const delay = Math.random() * 5;
                star.style.animationDuration = `${duration}s`; star.style.animationDelay = `-${delay}s`;
                starContainer.appendChild(star);
            }
        }

        function setupNavIndicators() {
            ALL_NAV_INDICATORS.forEach(indicator => {
                indicator.addEventListener('click', () => {
                    if (!lenisInstance) return;
                    const direction = indicator.dataset.direction;
                    const parentPhaseElement = indicator.closest('.phase-elements');
                    const currentPhaseNum = parseInt(parentPhaseElement.dataset.phaseNumber);
                    let targetPhaseNum;

                    if (direction === 'up') targetPhaseNum = currentPhaseNum - 1;
                    else targetPhaseNum = currentPhaseNum + 1;

                    if (targetPhaseNum >= 1 && targetPhaseNum <= TOTAL_PHASES) {
                        const targetScrollPosition = (targetPhaseNum - 1) * window.innerHeight * 0.9;
                        lenisInstance.scrollTo(targetScrollPosition);
                    }
                    hideAllNavIndicators(); 
                });
            });
        }

        function showActiveNavIndicators() {
            clearTimeout(indicatorVisibilityTimer); 
            hideAllNavIndicators();

            const activePhaseElement = phaseElementsList[currentActivePhaseNumber -1];
            if (!activePhaseElement) return;

            const upIndicator = activePhaseElement.querySelector('.nav-indicator-up');
            const downIndicator = activePhaseElement.querySelector('.nav-indicator-down');

            if (upIndicator) {
                if (currentActivePhaseNumber === 1) upIndicator.classList.add('hidden-conditional');
                else { upIndicator.classList.remove('hidden-conditional'); upIndicator.classList.add('visible'); }
            }
            if (downIndicator) {
                 if (currentActivePhaseNumber === TOTAL_PHASES) downIndicator.classList.add('hidden-conditional');
                else { downIndicator.classList.remove('hidden-conditional'); downIndicator.classList.add('visible'); }
            }
            indicatorVisibilityTimer = setTimeout(hideAllNavIndicators, 3000);
        }

        function hideAllNavIndicators() {
            ALL_NAV_INDICATORS.forEach(ind => ind.classList.remove('visible'));
        }
        
        function setupGlobalInteractionListener() {
            document.body.addEventListener('click', showActiveNavIndicators);
            document.body.addEventListener('touchstart', showActiveNavIndicators, { passive: true });
        }

        if (sessionStorage.getItem('isUnlocked') === 'true') {
            removeContentBlock();
            initializePageContent();
        } else {
            applyContentBlock();
            if (passwordInput) passwordInput.focus();
        }
    </script>
</body>
</html>
